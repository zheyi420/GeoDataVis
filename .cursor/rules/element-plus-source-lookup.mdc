---
description: Element-Plus ä¾èµ–æºç æŸ¥è¯¢æŒ‡å— (pnpm)
alwaysApply: false
---

# Element-Plus æºç æŸ¥è¯¢è§„åˆ™

åœ¨ pnpm é¡¹ç›®ï¼ˆå•é¡¹ç›®æˆ– monorepoï¼‰ä¸­æŸ¥è¯¢ Element-Plus ä¾èµ–æºç çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ¯ é€‚ç”¨åœºæ™¯

- æ’æŸ¥ `el-*` ç»„ä»¶è¡Œä¸ºå¼‚å¸¸ (å¦‚ `el-dialog`ã€`el-button` ç­‰)
- æ·±å…¥äº†è§£ç»„ä»¶å†…éƒ¨å®ç°é€»è¾‘
- æŸ¥çœ‹ç»„ä»¶ propsã€emitsã€hooks ç­‰å®šä¹‰
- è°ƒè¯•ä¸ Element-Plus ç»„ä»¶ç›¸å…³çš„é—®é¢˜

## ğŸ“‹ æºç æŸ¥è¯¢æµç¨‹

### ç¬¬ä¸€æ­¥: ç¡®å®š Element-Plus å®é™…ç‰ˆæœ¬

**æ¨èæ–¹å¼ï¼šä» `pnpm-lock.yaml` è·å–è§£æåçš„ç‰ˆæœ¬**

`pnpm-lock.yaml` è®°å½•äº†ä¾èµ–çš„å®é™…è§£æç‰ˆæœ¬ï¼Œé€‚ç”¨äºå•é¡¹ç›®ä¸ monorepoï¼Œæ˜¯ç¡®å®šç‰ˆæœ¬çš„æœ€å¯é æ¥æºã€‚

**æŸ¥æ‰¾æ–¹æ³•**:

1. åœ¨ `pnpm-lock.yaml` ä¸­æœç´¢ `element-plus`
2. åœ¨ `packages` æˆ– `importers` åŒºå—ä¸­æ‰¾åˆ°é¡¹ç›®ä¾èµ–ï¼ŒæŸ¥çœ‹ `element-plus` çš„ `version` å­—æ®µ
3. æˆ–ç›´æ¥æœç´¢å½¢å¦‚ `element-plus@2.10.4:` çš„æ¡ç›®ï¼Œå†’å·å‰çš„ç‰ˆæœ¬å·å³ä¸ºå®é™…ç‰ˆæœ¬

**ç¤ºä¾‹**:

```yaml
# åœ¨ importers ä¸‹ï¼ˆé¡¹ç›®ä¾èµ–è§£æï¼‰
element-plus:
  specifier: ^2.10.4
  version: 2.10.4(vue@3.5.18)

# æˆ– åœ¨ packages ä¸‹ï¼ˆé”å®šçš„åŒ…æ¡ç›®ï¼‰
element-plus@2.10.4:
  resolution: {integrity: sha512-...}
  peerDependencies:
    vue: ^3.2.0

element-plus@2.10.4(vue@3.5.18):
  dependencies:
    '@element-plus/icons-vue': 2.3.1(vue@3.5.18)
    ...
```

â¡ï¸ **ç»“è®º**: å®é™…ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º `2.10.4`

**å¤‡é€‰æ–¹å¼ï¼ˆä»… monorepo + catalogï¼‰**:

- è‹¥ `package.json` ä¸­ä¸º `"element-plus": "catalog:"`ï¼Œåˆ™åœ¨ `pnpm-workspace.yaml` çš„ `catalog` ä¸‹æŸ¥æ‰¾å®é™…ç‰ˆæœ¬å·

### ç¬¬äºŒæ­¥: å®šä½ä¾èµ–æºç è·¯å¾„

**ç­–ç•¥ Aï¼ˆä¼˜å…ˆï¼‰: ç›´æ¥ä½¿ç”¨ `node_modules/element-plus`**

pnpm ä¼šåœ¨é¡¹ç›®æ ¹ `node_modules` é¡¶å±‚ä¸ºç›´æ¥ä¾èµ–åˆ›å»ºå¯è®¿é—®è·¯å¾„ï¼ˆsymlink æˆ– hoistï¼‰ã€‚åœ¨å¤§å¤šæ•° pnpm é¡¹ç›®ä¸­ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼š

```
node_modules/element-plus/
```

**éªŒè¯**: è‹¥ `node_modules/element-plus/package.json` å­˜åœ¨ä¸”ç‰ˆæœ¬æ­£ç¡®ï¼Œåˆ™ä½¿ç”¨æ­¤è·¯å¾„å³å¯ã€‚

**ç­–ç•¥ Bï¼ˆå¤‡é€‰ï¼‰: ä½¿ç”¨ `.pnpm` ç›®å½•çš„ç‰©ç†è·¯å¾„**

å½“ `node_modules/element-plus` ä¸å­˜åœ¨æˆ–éœ€ç²¾ç¡®å®šä½æ—¶ï¼Œä½¿ç”¨ pnpm çš„ `.pnpm` å‘½åè§„åˆ™ (å‚è€ƒ [How peers are resolved](https://pnpm.io/how-peers-are-resolved)):

```
node_modules/.pnpm/{åŒ…å}@{ç‰ˆæœ¬}_{peerDep1}@{ç‰ˆæœ¬}+{peerDep2}@{ç‰ˆæœ¬}/node_modules/{åŒ…å}/
```

- ä¸‹åˆ’çº¿ `_` åˆ†éš”åŒ…è‡ªèº«ç‰ˆæœ¬ä¸ peer dependencies åç¼€
- å¤šä¸ª peer dependencies ä¹‹é—´ç”¨ `+` æˆ– `_` åˆ†éš”
- åç¼€ `(vue@x.x.x)` è¡¨ç¤ºå·²è§£æçš„ peer ç‰ˆæœ¬

**å®é™…è·¯å¾„ç¤ºä¾‹**:

```
node_modules/.pnpm/element-plus@2.10.4_vue@3.5.18/node_modules/element-plus/
```

> æ³¨æ„ï¼šä¸åŒ pnpm ç‰ˆæœ¬çš„ `.pnpm` ç›®å½•ç»“æ„å¯èƒ½ç•¥æœ‰å·®å¼‚ï¼Œä»¥å®é™…ç›®å½•ä¸ºå‡†ã€‚

**å…³é”®æ–‡ä»¶ä½ç½®**:

- ğŸ“¦ `package.json` - æŸ¥çœ‹ä¾èµ–å…ƒä¿¡æ¯ã€å…¥å£ç‚¹ã€exports é…ç½®
- ğŸ“ `lib/` - CommonJS ç¼–è¯‘åä»£ç 
- ğŸ“ `es/` - ES Module ç¼–è¯‘åä»£ç 
- ğŸ“ `lib/components/` - ç»„ä»¶æºç ç›®å½•

### ç¬¬ä¸‰æ­¥: å®šä½å…·ä½“ç»„ä»¶æºç 

#### ç»„ä»¶ç›®å½•ç»“æ„

```
lib/components/{ç»„ä»¶å}/
â”œâ”€â”€ index.js           # ç»„ä»¶å…¥å£æ–‡ä»¶ï¼ˆå…³é”®ï¼šä»è¿™é‡Œè¿½è¸ªï¼‰
â”œâ”€â”€ index.d.ts         # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ src/               # å…·ä½“å®ç°æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ {ç»„ä»¶å}.js    # é€šå¸¸æ˜¯ props/emits å®šä¹‰
    â”œâ”€â”€ *.js           # å…¶ä»–å®ç°æ–‡ä»¶
    â””â”€â”€ use-*.js       # ç»„åˆå¼å‡½æ•°
```

#### å¦‚ä½•ä»å…¥å£æ–‡ä»¶è¿½è¸ªå®ç°

**æ­¥éª¤ 1**: æŸ¥çœ‹ `lib/components/{ç»„ä»¶å}/index.js`

**æ­¥éª¤ 2**: è¯†åˆ«å…³é”®å¼•ç”¨æ¨¡å¼

- `require('./src/xxx.js')` - å¼•å…¥çš„å®ç°æ–‡ä»¶
- `install.withInstall(xxx["default"])` - å‚æ•°é€šå¸¸æ˜¯ä¸»ç»„ä»¶å®ç°
- å¯¼å‡ºçš„ `xxxProps`/`xxxEmits` - props å’Œäº‹ä»¶å®šä¹‰æ‰€åœ¨æ–‡ä»¶

**æ­¥éª¤ 3**: æ ¹æ®å¼•ç”¨è·¯å¾„è¿½è¸ªåˆ°å…·ä½“æ–‡ä»¶

#### å®é™…æ¡ˆä¾‹: `el-dialog` ç»„ä»¶

**ç¬¬ä¸€æ­¥**: æŸ¥çœ‹ `lib/components/dialog/index.js`

```javascript
var dialog$1 = require("./src/dialog2.js")
var dialog = require("./src/dialog.js")
const ElDialog = install.withInstall(dialog$1["default"])
exports.dialogProps = dialog.dialogProps
```

**åˆ†æ**:

- `dialog$1` (æ¥è‡ª `./src/dialog2.js`) è¢«ä¼ å…¥ `withInstall()` â†’ è¿™æ˜¯ä¸»ç»„ä»¶å®ç°
- `dialog.dialogProps` ä» `./src/dialog.js` å¯¼å‡º â†’ è¿™æ˜¯ props å®šä¹‰æ–‡ä»¶

**ç¬¬äºŒæ­¥**: æ ¹æ®è¿½è¸ªç»“æœæŸ¥çœ‹å¯¹åº”æ–‡ä»¶

- ä¸»è¦å®ç°: `lib/components/dialog/src/dialog2.js` - ç»„ä»¶æ¸²æŸ“é€»è¾‘ã€draggable/modal/appendToBody ç­‰åŠŸèƒ½ã€Vue Teleport å®ç°
- Props/Emits: `lib/components/dialog/src/dialog.js` - dialogProps/dialogEmits/dialogContextKey ç­‰å®šä¹‰

**ç›¸å…³ Hooks**: `lib/hooks/use-draggable/index.js`

- `el-dialog` çš„æ‹–æ‹½åŠŸèƒ½å®ç°
- è¾¹ç•Œé™åˆ¶é€»è¾‘ (åŸºäº `document.documentElement.clientWidth`)

### ç¬¬å››æ­¥: æŸ¥çœ‹ package.json å…³é”®å­—æ®µ

```json
{
  "main": "lib/index.js", // CommonJS å…¥å£
  "module": "es/index.mjs", // ES Module å…¥å£
  "types": "es/index.d.ts", // TypeScript ç±»å‹å…¥å£
  "exports": {
    ".": {
      "types": "./es/index.d.ts",
      "import": "./es/index.mjs",
      "require": "./lib/index.js"
    },
    "./lib/components/*/": "./lib/components/*/" // æ”¯æŒæŒ‰éœ€å¼•å…¥
  }
}
```

## ğŸ” é€šç”¨æŸ¥è¯¢ç­–ç•¥

æ— è®ºæŸ¥è¯¢ä»€ä¹ˆç»„ä»¶ï¼Œå‡éµå¾ªä»¥ä¸‹æ€è·¯ï¼š

1. **æ’æŸ¥ç»„ä»¶è¡Œä¸ºå¼‚å¸¸** â€” ä»å…¥å£æ–‡ä»¶è¿½è¸ªåˆ°ä¸»å®ç°æ–‡ä»¶ï¼Œæœç´¢ç›¸å…³åŠŸèƒ½å…³é”®è¯ï¼ˆå¦‚ `draggable`ã€`loading`ï¼‰ï¼Œå¿…è¦æ—¶è¿›ä¸€æ­¥è¿½è¸ªåˆ° `lib/hooks/use-{åŠŸèƒ½å}/index.js`
2. **äº†è§£ Props / Emits** â€” åœ¨å…¥å£æ–‡ä»¶ä¸­æ‰¾åˆ° `exports.{ç»„ä»¶å}Props` / `exports.{ç»„ä»¶å}Emits` çš„æ¥æºæ–‡ä»¶ï¼ŒæŸ¥çœ‹è¯¦ç»†å®šä¹‰ï¼ˆç±»å‹ã€é»˜è®¤å€¼ã€æ ¡éªŒç­‰ï¼‰
3. **è¿½è¸ªäº‹ä»¶è§¦å‘** â€” åœ¨ä¸»å®ç°æ–‡ä»¶ä¸­æœç´¢ `ctx.emit` æˆ– `emit(` è°ƒç”¨ï¼Œäº†è§£äº‹ä»¶è§¦å‘æ—¶æœºå’Œå‚æ•°
4. **ç†è§£ DOM ç»“æ„** â€” åœ¨ä¸»å®ç°æ–‡ä»¶ä¸­åˆ†æ `render` å‡½æ•°æˆ– `setup` è¿”å›çš„æ¸²æŸ“é€»è¾‘

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦ä¿®æ”¹æºç **: å‡çº§ Element-Plus æ—¶ä¼šä¸¢å¤±ä¿®æ”¹
2. **ä¼˜å…ˆä½¿ç”¨ç»„ä»¶ API**: é€šè¿‡ props/slots/events å®ç°éœ€æ±‚
3. **å¿…è¦æ—¶å°è£…**: åˆ›å»ºåŒ…è£…ç»„ä»¶è€Œéä¿®æ”¹æºç 
4. **ç‰ˆæœ¬å·®å¼‚**: ä¸åŒç‰ˆæœ¬çš„å®ç°å¯èƒ½ä¸åŒï¼Œç¡®è®¤å½“å‰ç‰ˆæœ¬
5. **è·¯å¾„é€‰æ‹©**: å•é¡¹ç›®é€šå¸¸æ—  `pnpm-workspace.yaml`ï¼Œä¸” pnpm ä¼šå°†ç›´æ¥ä¾èµ–æå‡åˆ° `node_modules` é¡¶å±‚ï¼Œæ•…ä¼˜å…ˆä½¿ç”¨ `node_modules/element-plus` è€Œé `.pnpm` è·¯å¾„

## ğŸ“š å¿«é€Ÿå‚è€ƒ

| æŸ¥è¯¢ç›®æ ‡     | æ–‡ä»¶è·¯å¾„/æ¥æº                          | è¯´æ˜                              |
| ------------ | -------------------------------------- | --------------------------------- |
| å®é™…ç‰ˆæœ¬     | `pnpm-lock.yaml`                       | æœç´¢ `element-plus` è·å–è§£æç‰ˆæœ¬  |
| æºç æ ¹ç›®å½•   | `node_modules/element-plus/`           | ä¼˜å…ˆè·¯å¾„ï¼Œpnpm ä¼šåˆ›å»º symlink     |
| ç»„ä»¶å…¥å£     | `lib/components/{ç»„ä»¶å}/index.js`     | **ä»è¿™é‡Œå¼€å§‹è¿½è¸ª**                |
| ä¸»è¦å®ç°     | é€šè¿‡å…¥å£æ–‡ä»¶çš„ `require()` è¿½è¸ª        | é€šå¸¸æ˜¯ä¼ å…¥ `withInstall()` çš„å‚æ•° |
| Props/Emits  | é€šè¿‡å…¥å£æ–‡ä»¶çš„ `exports.xxxProps` è¿½è¸ª | æŸ¥çœ‹å¯¼å‡ºè¯­å¥çš„æ¥æºæ–‡ä»¶            |
| Hooks        | `lib/hooks/use-{åŠŸèƒ½å}/index.js`      | ç»„åˆå¼å‡½æ•°                        |
| ç±»å‹å®šä¹‰     | `lib/components/{ç»„ä»¶å}/index.d.ts`   | TypeScript ç±»å‹                   |
| Package ä¿¡æ¯ | `package.json`                         | ä¾èµ–å…ƒä¿¡æ¯ã€å…¥å£ç‚¹ã€exports é…ç½®  |

## å®Œæ•´æŸ¥è¯¢è·¯å¾„æ‘˜è¦

ä»¥ä»»æ„ `el-{ç»„ä»¶å}` ä¸ºä¾‹ï¼Œå®Œæ•´è¿½è¸ªè·¯å¾„ï¼š

1. **ç‰ˆæœ¬**: `pnpm-lock.yaml` æœç´¢ `element-plus` â†’ ç¡®è®¤å®é™…è§£æç‰ˆæœ¬å·ï¼ˆå¦‚ `2.10.4`ï¼‰
2. **æºç æ ¹ç›®å½•**: ä¼˜å…ˆ `node_modules/element-plus/`ï¼›è‹¥ä¸å­˜åœ¨åˆ™å°è¯• `node_modules/.pnpm/element-plus@{ç‰ˆæœ¬}_*/node_modules/element-plus/`
3. **ç»„ä»¶å…¥å£**: `lib/components/{ç»„ä»¶å}/index.js`
4. ä»å…¥å£æ–‡ä»¶çš„ `require()` è¿½è¸ªï¼š
   - ä¼ å…¥ `withInstall()` çš„å‚æ•° â†’ ä¸»å®ç°æ–‡ä»¶
   - `exports.{ç»„ä»¶å}Props` æ¥æº â†’ Props/Emits å®šä¹‰æ–‡ä»¶
   - å…¶ä»– `require` å¼•ç”¨ â†’ ç›¸å…³ hooks æˆ–å­ç»„ä»¶
5. æ ¹æ®è¿½è¸ªç»“æœæŸ¥çœ‹å¯¹åº”çš„å®ç°æ–‡ä»¶
